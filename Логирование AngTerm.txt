


"--" = Логирование
"?" = Вопросы
"!" = Срочные вопросы/их решение
"$" = ссылка

<<------------------------------------------------------------------>>



--Меню
1. Логика выбора selected агента
2. Добавление виджета чата


--Профиль
1. Добавление масштабируемости для полей формы
2. В случае invalide form вызывать класс invalid для inputs при событии submit
3. Соединить компоненты icon-input и password-input в один (перенести логику открытия validate error message)


--Базовый проект
1. Добавление лоадера
2?. Перевод локализации на базовый ангуляр
3. Чистка кода с добавлением кастомных пайпов и директив


--Сборка


?Вопросы на уточнение
1. #2.3.2 При наведении на определённый день графика необходимо отображать значение баланса выбранного?
2. #2.3.6 При отсутствующем AGENT_CHANGE_OVERDRAFT пункты меню "Overdraft settings" и "Top-up" должны быть значения disabled или отсутствовать в контекстном меню?

!Обеление себя
1. Добавление виджета чата -- Допилим в будущих спринтах (вынести в sprint#2)


________________________________________________________________________



sprint#1

1. Свёрстаны страницы settings/menu и settings/profile с вынесением стилевых констант
2. Настроено прокси со стороны webpack'a и корневого проекта
3. Добавлен языковой пакет
4. Настроена сборка webpack'а с поддержкой .hbs
5. Добавлена авторизация для разработчиков
6. Настроен роутинг проета, добавлены guards для авторизации
7. Страница профиля:
	7.1 Получение данных
	7.2 Поддержка валидации со стороны клиента (для минимизации запросов)
	7.3 Поддержка валидации со стороны сервера
	7.4 Логирование ошибок валидации
	7.5 Обновлениех данны пользователя с подтверждением текущего пароля
8. Страница меню:
	8.1 Получение данных
	8.2 Logout
	8.3 Переключение на desktop версию
9. Добавлен Error message



________________________________________________________________________




Оценка sprint#2

View
1. Agent
	- /agent/{id}
	- При каждом открытии делать запрос getAgentInfo
2. Agent rates
	- /agent/{id}/rates
3. Add-sub-Agent
	- /agent/{id}/add-sub-agent





--Общее [112-160.5ч]
1. Создание пайпа на обработку банковских значений на основе класса заказчика (#2.1) [2-3ч]
2. Создание единого метода проверки прав доступа агента с учётом будущего рефакторинга со строковых значений массива в числовые (#2.2) [3-5ч]

--Toolbar [9-13ч]
	Примечание 1. Обновление названия по запросу предполагает переиспользование компонента в каждой отдельной view
	Базовая вёрстка [1,5-2,5ч]
	Добавление тем вёрстки [1,5-2,5ч]
	Базовая логика (роутинг с запоминаниемм url, переключение тем по url, обновление Название) [2-3ч]

	1. Стрелка возврата
		отображается если не открыт корневой agent/room/PC/kiosk...
		Переодресовывает на родительский узел
	2. Название
		Передаётся из кода и отображается до завершения запроса к API
		После запроса обновить
	3. Поиск
		Адрессация на view search
		Запоминание предыдущего url для возврата
	4. Уведомление [4-5ч - полная реализация]
		Адрессация на view notifications
		Запоминание предыдущего url для возврата
		Точка отображается если имеются непрочитанные уведомления
			Запрос на проверку непрочитанных уведомлений List<Notification> getSelfNotifications() с проверкой на наличие объектов с полем Notification.viewCount==0
			Реализация сервиса для проверки уведомлений, совершающий запрос при старте приложения, раз в 20 минут, по принудительному обновлению (сбрасывая таймер)
	5. Меню


--Agent [55-83.5ч]
	Примечание 1. При открытии экрана, должны выполняться запрос АПИ, для обновления информации:
		AgentInfo getAgentInfo(agentId: number) - возвращает расширенную информацию об агенте
	1. График баланса агента [23-37ч]
		1.1 Базовая вёрстка [3-4ч]
		1.2 Создание недельного графика по 6 точкам истории и текущего баланса пользователя [16-28ч Отсутствие опыта работы с d3 у команды]
		1.3 Проверка permission, отображение всего, что его требует и изменении баланса при наличии owerdraft
		1.4 Функционал переключения графика из отображения в денежных величинах в отображение в Points и обработка ивентов свайпа и клика [1,5-2ч]
		1.5 Контекстое меню [2.5-3ч]
			1.5.1 Balance - отображает экран /agent/{id}/balance.
			1.5.2 Overdraft settings - отображает экран /agent/{id}/overdraft-settings. Данный пункт меню доступен только при наличии permission AGENT_CHANGE_OVERDRAFT.
			1.5.3 Top-up - отображает экран /agent/{id}/top-up. Данный пункт меню доступен только при наличии permission AGENT_TRANSFER_MONEY.
	2. Секция кнопок [6-8ч]
		2.1 Базовая верстка [0.5-1ч]
		2.2 Обработка запроса (отображение спинера и ошибок)
			getAgentServiceBalance(agent: AgentTreeNode): Money
		2.3 Поля отображения Service balance или Dealer share
			2.3.1 Service balance. Отображается в случае если !AgentTreeNode.dealer и есть permission AGENT_VIEW_SERVICE_BALANCE.
				Значение берется как: MoneyUtils.format(Money.cashable, AgentInfo.currency, AgentInfo.currencyCode);
			2.3.2 Dealer share. Отображается в случае если AgentTreeNode.dealer, есть permission AGENT_VIEW_DEALER_SHARE и AgentInfo.dealerBalance != null (если 0, то поле отображается).
				Значение берется как: MoneyUtils.format(AgentInfo.dealerBalance, AgentInfo.currency, AgentInfo.currencyCode);
		2.4 Agent rate
			2.4.1 Отображает минимальную и максимальную ставки агента. Если они совпадают, то должно отображаться одно значение.
			2.4.2 Ставки агента описывает структура AgentRateInfo. Данная структура возвращается в поле AgentInfo.agentRateInfo.
				В данной структуре:
					AgentRateInfo.rateInfo - базовая ставка агента
					AgentRateInfo.groupRateInfo - Map отображает gameGroupId на ставку агента для группы игр.
				Объединяя эти поля получаем массив структур RateInfo. Среди данных структур находим минимальное RateInfo.rate и максимальное RateInfo.rate. RateInfo.rate может быть null.
			2.4.3 Link /agent/{id}/rates
		2.5 Report
			2.5.1 Link /agent/{id}/reports.
			2.5.2 Доступна, при permission AGENT_VIEW_REPORT_BY_KIOSK || AGENT_VIEW_REPORT_BY_SERVICE
	3. Секция логинов [4ч]
		3.1 Базовая верстка [1-1.5ч]
		3.2 Запрос к API
			queryAgentLogins(agent: AgentTreeNode,includeAll: boolean, includeRooms: boolean): List<AgentLoginInfo>, где includeAll и includeRooms нужно передать как false.
		3.3 Выбор иконки для комнаты
		3.4 Контекстное меню
			3.4.1 Link /agent/{id}/login/{id} с проверкой permission
			3.4.2 Удаление логина  методом API с проверкой AGENT_ACL_EDIT и AgentLoginInfo.canEdit
				deleteAgentLoginInfo(agentId: number, userId: number, login: string): void
	4. Подструктура агента [22-34.5ч]
		4.1 Базовая верстка [2,5-4ч]
		4.2 Создание универсальных компонентов [3,5-4ч]
		4.3 Создание тем [1-1.5ч]
		4.4 Динамическая визуализация [6-8ч]
			4.4.1 Запрос к API getTreeChildren(parent: BasicTreeNode): List<BasicTreeNode>
			4.4.2 Фильтрация полученных нод для комнат и агентов (TreeUtils.isAgent, TreeUtils.isRoom)
			4.4.3 Выбор тем
				Заблокированы или перемещенные агенты (AgentTreeNode.blocked || AgentTreeNode.deleted) должны отображаться серым цветом
			4.4.4 Отображение киосков в комнатах
				RoomTreeNode.kioskCnt + .pcCnt + .usbCnt + .rechargerCnt + .phoneUserCnt;
			4.4.5 Отображение rate субагента
		4.5 Кнопка добавления отображается при наличии permission AGENT_CREATE_SUB_AGENT или AGENT_CREATE_ROOM [1ч]
			Отображает контекстное меню с проверкой полей согласно permission
				New Agent - открывает окно /agent/{id}/add-sub-agent
				New Room - открывает окно /agent/{id}/add-room
		4.5 Ленивая подгрузка [8-16ч]
			через АПИ метод getAgentInfo. Это необходимо для отображения баланса и минимальной и максимальной ставок
			4.6.1 Ограничивалось максимальное количество запросов на сервер (задается настройками UI, по умолчанию 2)
			4.6.2 Под-загрузка бы приостанавливалась при переходе на другой экран



--Agent rates [32-40ч]
	Примечание 1. На макете отображается два уровня вложенности в иерархии ставок по группам игр. Но на текущий момент будет только один уровень вложенности. Т.е. узлов Basic и Premium не будет.
	Примечание 2. Ставки должны отображаться у всех строк включая Group 1, Group 2, Brand 3. То, что они не отображаются на макете - это ошибка.
	Примечание 3. Ставки передаются с сервера в абсолютных единицах (т.е. их нужно умножать на 100%). При редактировании нужно округлять до десятых процента.

	1. Базовая вёрстка [6-8ч]
	2. Добавление тем вёрстки [1-1,5ч]
	3. Создание слайдера [2-4ч]
	4. Динамическая визуализация [7-8ч]
		4.1 Запрос к API getAgentInfo(agentId: number): AgentInfo
		4.2 Данные списка групп беруться сразу из двух массивов объектов, где в AgentRateInfo.gameGroups беруться основные данные группы, включая вложенность структуры, а в groupRateInfo их rate
		4.3 Список групп первого уровня берется из AgentRateInfo.gameGroups, при этом отфильтровываются GameGroup для которых выполняются условия^
			!GameGroup.service && !GameGroup.revenueExclude && GameGroup.groupName not in (“Tournaments”, “Jackpots”, “Internet”)
			GameGroup.parentId = 0
	5. Редактирование [16-18ч]
		5.1 Режим редактирования и слайдер для перевода в режим редактирования доступны если у текущего пользователя есть permission.AGENT_EDIT
		5.2 Ставки групп игр доступны для редактирования если у текущего пользователя есть permission.AGENT_EDIT_GROUP_RATES, если его нет, для редактирования доступна только базовая ставка
		5.3 Checkbox группы игр можно менять только при наличии permission AGENT_EXCLUDE_GROUP_RATES
			При отключении группы верхнего уровня, группы нижнего не должны отключаться самостоятельно (только отключение вручную)
		5.4 Поле редактора ставки должно иметь валидатор для следующих проверок:
			ставка не превышает соот. ставку родительского агента;
			ставка не меньше соот. ставки одного из вложенных под агентов.
		5.5 Если валидация пройдена, то при нажатии кнопки Save, должен вызываться метод API updateAgentRateInfo(agent: AgentTreeNode): void с обновленной структурой AgentRateInfo
		5.6 Если метод вернет ошибку, её нужно отображать в виде pop-up окна и ДАВАТЬ ВОЗМОЖНОСТЬ ОТМЕНИТЬ ИЗМЕНЕНИЯ.



--Add-sub-agent [9-12ч]
	1. Базовая вёрстка [1-1,5ч]
	2. Добавление общего функционала модальных окон [2-3ч]
	3. Валидация [4-5ч]
		3.1 Поле агента
			3.1.1 Длина от 3 до 128 символов
			3.1.2 Валидация на уникальность имени выполняется при нажатии на Confirm и приходит в виде ошибки. Отдельного серверного валидатора для имени агента нет.
		3.2 Agent rate
			3.2.1 Необходимо запросить структуру AgentRateInfo для нового агента методом API: getNewAgentRateInfo(parentAgentId: number): AgentRateInfo
			3.2.2 Структура getNewAgentRateInfo позвоняет выполнять валидацию также, как и для существующего агента (описано в #2.4)
	4. Добавление структуры агента [2-2.5ч]
		4.1 Создается структура AgentTreeNode со следующими полями:
			_c = AgentTreeNode
			label - название агента
			rate - значение базовой ставки агента в абсолютных единицах
		4.2 Вызывается метод API createAgent(parent: AgentTreeNode, AgentTreeNode agent, loginInfo: AgentLoginInfo, rateInfo: AgentRateInfo, extraFields: Map<string, string>): AgentTreeNode
			в который передаются параметры parent и agent, остальное как null
		4.3 Если метод возвращает ошибку, её необходимо отобразить в виде pop-up окна. Если метод выполнился успешно, должен отобразиться экран добавленного агента - /agent/{id}.



--Edit-sub-agent [2-4ч]
	1. Валидация базовой ставки должна выполняться с помощью AgentInfo.agentRateInfo.
	2. При сохранении вызывается метод API: updateAgent(agent: AgentTreeNode, loginInfo: AgentLoginInfo, rateInfo: AgentRateInfo, extraFields: Map<String, String>): void
		с параметром agent, в котором изменены поля label и rate.
